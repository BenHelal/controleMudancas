{% extends 'base.html.twig' %}


{% block body %}
	<link href="https://cdn.jsdelivr.net/npm/tom-select@2.1.0/dist/css/tom-select.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/tom-select@2.1.0/dist/js/tom-select.complete.min.js"></script>
	<div class="container" style="padding-left: 20px ;padding-right: 20px;">
		<div class="py-5 text-center">
			<img class="d-block mx-auto mb-4" src="{{ asset('assets/logo.png')}}" alt="" width="72" height="72"/>
			<h2>Controle de Mudança</h2>
			<br>
		</div>
	</div>
	<div class="row">
		<table class="table">
			<thead>
				<tr>
					<th scope="col">Tipo de Aprovação</th>
					<th scope="col">Área/Cliente</th>
					<th scope="col">Nome do Aprovador</th>
					<th scope="col">Status Aprovação</th>
					<th scope="col">Comentário</th>
				</tr>
			</thead>


			<tbody>
				<tr>
					<th scope="row">Solicitante</th>
					<td>
						{% if mud.addBy.name != null %}
							{{mud.addBy.departemant}}
						{% endif %}
					</td>
					<td>
						{% if mud.addBy != null %}
							{{mud.addBy.name}}
						{% endif %}
					</td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<th scope="row">Gerente Solicitante</th>
					<td>
						{% if mud.managerUserAdd != null %}
							{{mud.managerUserAdd.departemant}}
							{% else %}

						{% endif %}
					</td>
					<td>
						{% if mud.managerUserAdd != null %}
							{{mud.managerUserAdd.name}}
						{% else %}
							Projeto Nansen
						{% endif %}
					</td>
					<td>
						{% if mud.managerUserApp != null %}
							{% if mud.managerUserApp == 1 %}
								Aprovado
							{% elseif mud.managerUserApp == 2 %}
								Rejeitado
							{% endif %}
						{% else %}
							Não verificado
						{% endif %}
					</td>
					<td>
						{% if mud.managerUserComment != null %}
							{{mud.managerUserComment}}
						{% else %}
							Sem comentário
						{% endif %}
					</td>
				</tr>
				<tr>
					<th scope="row">Gerente Aprovação</th>
					{% if p == null %}
						<td>Não verificado</td>
						<td>Não verificado</td>
					{% else %}
						<td>{{mud.areaResp.name}}</td>
						<td>{{mud.areaResp.manager.name}}</td>
					{% endif %}

					{% if mud.appMan == 1 %}
						<td>Aprovado</td>
					{% elseif mud.appMan == 2  %}
						<td>Rejeitado</td>
					{% elseif  mud.appMan == null  %}
						<td>Não verificado</td>
					{% endif %}


					{% if mud.comMan != null %}
						<td>{{mud.comMan}}</td>
					{%  else %}
						<td>
							Sem comentário</td>
					{% endif %}
				</tr>
				<tr>
					<th scope="row">Gestor da Mudança</th>
					{% if mud.mangerMudancas == null %}
						<td>Não verificado</td>
						<td>Não verificado</td>
					{% else %}
						<td>{{mud.mangerMudancas.departemant}}</td>
						<td>{{mud.mangerMudancas.name}}</td>
					{% endif %}
					{% if mud.appGest == null %}
						<td>Não verificado</td>
					{% elseif mud.appGest == 1 %}
						<td>Aprovado</td>
					{% elseif mud.appGest == 2 %}
						<td>Rejeitado</td>
					{% endif %}

					{% if mud.appGest == null %}
						<td>
							Sem comentário</td>
					{% else %}
						<td>{{mud.comGest}}</td>
					{% endif %}
				</tr>

				{% for key, m in data %}
					<tr>
						<th scope="row">Área Impactada</th>
						<td>{{m.name}}</td>
						<td>{{data2[key].name }}</td>
						{% if  m.appSectorMan  == 1  %}
							<td>Aprovado</td>
						{% elseif m.appSectorMan == 0 and  m.comment != null %}
							<td>Rejeitado</td>
						{% elseif m.appSectorMan == null   %}
							<td>Não verificado</td>
						{% endif %}


						{% if m.comment == null %}
							<td>
								Sem comentário</td>
						{% else %}
							<td>{{m.comment}}</td>
						{% endif %}
					</tr>

				{% endfor %}


				{% if client != null and mud.client != null  %}
					<tr>
						<th scope="row">Aprovação do Cliente</th>

						<td>{{mud.client.name}}</td>
						<td>{{mud.client.Resp}}</td>
						{% if  client.mud.TokenData.appClt  == 1  %}
							<td>Aprovado</td>
						{% elseif client.mud.TokenData.appClt == 2 %}
							<td>Rejeitado</td>
						{% elseif client.mud.TokenData.appClt == null   %}
							<td>Não verificado</td>
						{% endif %}

						{% if client.mud.TokenData.comClt == null %}
							<td>
								Sem comentário</td>
						{% else %}
							<td>
								{{client.mud.TokenData.codeExp.date|date('d-m-Y') }}<br>
								{{client.mud.TokenData.comClt}}</td>
						{% endif %}
					</tr>
				{% endif %}
				{% if mud.implemented != null and mud.mangerMudancas != null %}
					<tr>
						<th scope="row">Dados de implementação</th>
						<td>{{mud.mangerMudancas.departemant}}</td>
						<td>{{mud.mangerMudancas.name}}</td>
						{% if  mud.implemented  == 1  %}
							<td>Implementado</td>
						{% elseif mud.implemented == 2 %}
							<td>Não implementado</td>
							{% else %}
							<td>Não implementado</td>

						{% endif %}

						{% if mud.impDesc == null %}
							<td>
								Sem comentário</td>
						{% else %}
							<td>
								{{mud.dateOfImp}}<br>
								{{mud.impDesc}}</td>
						{% endif %}
					</tr>
				{% else %}
					<tr>
						<th scope="row">Dados de implementação</th>

						<td>{{mud.managerUserAdd.departemant}}</td>
						<td>{{mud.managerUserAdd.name}}</td>
						{% if  mud.implemented  == 1  %}
							<td>Implementado</td>
						{% elseif mud.implemented == 2 %}
							<td>Não implementado</td>
						{% endif %}
							<td>Ainda não implementada</td>
						{% if mud.impDesc == null and mud.implemented == null %}
							<td>
								Sem comentário</td>
								{% else %}
								<td>
								{{mud.dateOfImp|date('d-m-Y')}}
								Sem comentário</td>
						{% endif %}
					</tr>
				{% endif %}
			</tbody>
		</td>
	</tbody>
</tr></tbody></table></div>{% endblock %}
