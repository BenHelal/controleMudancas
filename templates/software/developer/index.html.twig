{% extends 'base.html.twig' %}

{% block title %}Hello Gestor Controller!
{% endblock %}

{% block body %}
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">

	<style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
    }

    .kanban-board {
      display: flex;
      overflow-x: auto;
      padding: 20px;
    }

    .column {
      background-color: #fff;
      border-radius: 5px;
      padding-bottom: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .column-header {
      background-color: #545f5d;
      color: #fff;
      padding: 10px;
      text-align: center;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;
    }

    .task-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    .task {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      margin: 10px;
      cursor: pointer;
    }

    .task:hover {
      background-color: #e6e6e6;
    }
    .task-list {
      min-height: 100px;
    }

    .task-list::before {
      content: "Arraste e solte tarefas aqui";
      display: block;
      text-align: center;
      color: #888;
      padding: 10px;
    }
  </style>

	{{ include('flowBoard.html.twig') }}
 
</head>
<body>

<div class="kanban-board row col-md-12 mb-3  justify-content-between">
    <div class="column col-md-3 mb-3">
        <div class="column-header">Pendência</div>
        <ul class="task-list" id="todo-list" ondrop="drop(event)" ondragover="allowDrop(event)">
            {% for s in step %}
                {% if s.status != 'análise' and s.status != 'análise ti' and s.status != 'feito' and s.status != 'em andamento' and s.status != 'fechar' %}
                    <li class="task" id="{{s.id}}" data-status="todo" draggable="true" ondragstart="drag(event)">{{s.title}}</li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>

  <div class="column col-md-3 mb-3">
    <div class="column-header">Em andamento</div>
    
    <ul class="task-list" id="done-list" ondrop="drop(event)" ondragover="allowDrop(event)"> {% for s in step %}
               
                {% if s.status == 'em andamento'  %}
                    <a class="w3-btn w3-white w3-border w3-round-large" data-toggle="modal" data-target="#Contato" id="{{s.id}}" data-status="todo" draggable="true" ondragstart="drag(event)">
                      <li class="task" >{{s.title}}</li>
                    </a>
                {% endif %}
            {% endfor %}
        </ul>
  </div>

  <div class="column col-md-3 mb-3">
    <div class="column-header">Análise TI</div>
    <ul class="task-list" id="done-list" ondrop="drop(event)" ondragover="allowDrop(event)">
    
         {% for s in step %}
                {% if s.status == 'análise ti'  %}
                    <li class="task" id="{{s.id}}" data-status="todo" draggable="true" ondragstart="drag(event)">{{s.title}}</li>
                {% endif %}
            {% endfor %}
    </ul>
  </div>



  <div class="column col-md-3 mb-3">
    <div class="column-header">Análise</div>
    <ul class="task-list" id="done-list" ondrop="drop(event)" ondragover="allowDrop(event)">
    
         {% for s in step %}
                {% if s.status == 'análise'  %}
                    <li class="task" id="{{s.id}}" data-status="todo" >{{s.title}}</li>
                {% endif %}
            {% endfor %}
    </ul>
  </div>

  <div class="column col-md-6 mb-3">
    <div class="column-header">Feito</div>
    <ul class="task-list" id="done-list">
    
    
         {% for s in step %}
                {% if s.status == 'feito'  %}
                    <li class="task" id="{{s.id}}" data-status="todo" draggable="true" ondragstart="drag(event)">{{s.title}} </li>
                {% endif %}
            {% endfor %}
    </ul>
  </div>

  <div style="width : 100%" class="column  col-md-6 mb-3 ">
    <div style="width : 100%" class="column-header">Fechar</div>
    <ul style="width : 100%" class="task-list" id="done-lists">
        
         {% for s in step %}
                {% if s.status == 'fechar'  %}
                    <li class="task" id="{{s.id}}" data-status="todo" draggable="true" ondragstart="drag(event)">{{s.title}}</li>
                {% endif %}
            {% endfor %}
    </ul>
  </div>
</div>



    <script>
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);

            // Find the target column by looking at the parent element of the drop target
            var targetColumn = ev.target.closest('.column');

            // Append the dragged element to the task list of the target column
            targetColumn.querySelector('.task-list').appendChild(draggedElement);

            // Get the status of the new column
            var newStatus = targetColumn.querySelector('.column-header').innerText.toLowerCase();

            // Get the task ID
            var taskId = draggedElement.id;

            // Perform AJAX update
            updateTaskStatus(taskId, newStatus);
        }

        function updateTaskStatus(taskId, newStatus) {
            // Perform AJAX request to update task status
            var xhr = new XMLHttpRequest();
            xhr.open('POST', "{{ path('update_task_status') }}", true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log('Task status updated successfully');
                }
            };
            xhr.send('taskId=' + taskId + '&newStatus=' + newStatus);
        }
    </script>

</body>

{% endblock %}